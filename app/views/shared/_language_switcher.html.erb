<div class="relative inline-block text-left" data-controller="language-switcher">
  <div class="relative">
    <!-- Language switcher button -->
    <button type="button" 
            class="inline-flex items-center justify-center w-8 h-8 rounded-lg border-2 border-red-500 bg-yellow-300 text-sm font-medium text-slate-700 hover:bg-slate-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 cursor-pointer"
            data-language-switcher-target="button"
            data-action="click->language-switcher#toggle"
            aria-expanded="false"
            aria-haspopup="true">
      <span class="<%= I18n.locale == :es ? 'text-blue-600' : 'text-slate-600' %>">
        <%= I18n.locale == :es ? 'ES' : 'EN' %>
      </span>
      <svg class="-mr-1 ml-1 h-4 w-4" fill="currentColor" viewBox="0 0 20 20">
        <path fill-rule="evenodd" d="M5.293 7.293a1 1 0 011.414 0L10 10.586l3.293-3.293a1 1 0 111.414 1.414l-4 4a1 1 0 01-1.414 0l-4-4a1 1 0 010-1.414z" clip-rule="evenodd" />
      </svg>
    </button>
    
    <!-- Dropdown menu - minimal width to fit content exactly -->
    <div class="hidden absolute top-full right-0 mt-1 bg-white border border-gray-300 rounded-md shadow-lg z-[9999] whitespace-nowrap" 
         data-language-switcher-target="menu">
      <div class="py-1">
        <% 
          current_path = request.path
          path_without_locale = current_path.gsub(/^\/[a-z]{2}(?=\/|$)/, '')
          path_without_locale = "/#{path_without_locale}" unless path_without_locale.start_with?('/')
          path_without_locale = "/" if path_without_locale.blank?
        %>
        
        <% if I18n.locale == :en %>
          <!-- Show Spanish option when English is selected -->
          <a href="/es<%= path_without_locale %>" 
             class="text-gray-700 hover:bg-gray-100 block px-2 py-1 text-sm text-center">
            ES
          </a>
        <% else %>
          <!-- Show English option when Spanish is selected -->
          <a href="/en<%= path_without_locale %>" 
             class="text-gray-700 hover:bg-gray-100 block px-2 py-1 text-sm text-center">
            EN
          </a>
        <% end %>
      </div>
    </div>
  </div>
</div>
