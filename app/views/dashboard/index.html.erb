<!-- DASHBOARD PAGE: Financial Overview -->
<main class="dashboard-page" data-controller="dashboard-charts">
  
  <!-- HIDDEN DATA: Chart Data for JavaScript -->
  <input type="hidden" id="spending-data" value="<%= (@spending_trends || []).to_json %>">
  <input type="hidden" id="category-data" value="<%= (@category_summary || []).to_json %>">
  <input type="hidden" id="balance-data" value="<%= (@bank_summaries || []).to_json %>">

  <!-- HEADER SECTION: Dashboard Header with Navigation -->
  <header class="dashboard-header">
    <div class="dashboard-header-container">
      <div class="dashboard-header-content">
        
        <!-- HEADER LEFT: Brand and Title -->
        <div class="dashboard-header-left">
          <div class="dashboard-header-brand">
            <div class="dashboard-header-logo">
              <svg class="dashboard-header-logo-icon" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 10h18M7 15h1m4 0h1m-7 4h12a3 3 0 003-3V8a3 3 0 00-3-3H6a3 3 0 00-3 3v8a3 3 0 003 3z"></path>
              </svg>
            </div>
            <div>
              <h1 class="dashboard-header-title"><%= t('financial_dashboard') %></h1>
              <p class="dashboard-header-subtitle"><%= t('welcome_back') %>, <%= current_user.full_name %></p>
            </div>
          </div>
        </div>
        
        <!-- HEADER RIGHT: Date and Upload Button -->
        <div class="dashboard-header-right">
          <div class="dashboard-header-date">
            <p class="dashboard-header-date-label"><%= t('current_month') %></p>
            <p class="dashboard-header-date-value">
              <%= Date.current.strftime("%B %Y") %>
            </p>
          </div>
          <div class="dashboard-header-divider"></div>
          <a href="/statement_files/new" class="dashboard-header-upload-button">
            <svg class="dashboard-header-upload-icon" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4"></path>
            </svg>
            <%= t('upload_statement') %>
          </a>
        </div>
      </div>
    </div>
  </header>

  <!-- MAIN CONTENT: Dashboard Content Area -->
  <div class="dashboard-main">
    
    <!-- ERROR DISPLAY: Error Messages -->
    <% if @error %>
      <div class="dashboard-error">
        <div class="dashboard-error-content">
          <div class="dashboard-error-icon">
            <svg class="dashboard-error-icon-svg" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-2.5L13.732 4c-.77-.833-1.964-.833-2.732 0L3.732 16.5c-.77.833.192 2.5 1.732 2.5z"></path>
            </svg>
          </div>
          <div>
            <h3 class="dashboard-error-text"><%= t('dashboard_error') %></h3>
            <p class="dashboard-error-description"><%= @error %></p>
          </div>
        </div>
      </div>
    <% end %>

    <!-- TOTAL BALANCE CARD: Portfolio Balance Overview -->
    <section class="dashboard-balance-section">
      <div class="dashboard-balance-card">
        <div class="dashboard-balance-content">
          <div>
            <h2 class="dashboard-balance-left"><%= t('total_portfolio_balance') %></h2>
            <div class="dashboard-balance-amount">
              <%= format_currency(@total_balance) %>
            </div>
            <p class="dashboard-balance-subtitle">
              <%= t('across_accounts', count: @bank_accounts.count) %>
            </p>
          </div>
          <div class="dashboard-balance-right">
            <div class="dashboard-balance-icon-container">
              <svg class="dashboard-balance-icon" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2zm0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z"></path>
              </svg>
            </div>
          </div>
        </div>
      </div>
    </section>

    <!-- MONTHLY SUMMARY CARDS: Income, Expenses, Net Flow -->
    <section class="dashboard-metrics-grid">
      
      <!-- INCOME METRIC CARD -->
      <div class="dashboard-metric-card">
        <div class="dashboard-metric-content">
          <div>
            <p class="dashboard-metric-label"><%= t('monthly_income') %></p>
            <p class="dashboard-metric-value dashboard-metric-value-income">
              <%= format_currency(@monthly_summary[:income]) %>
            </p>
          </div>
          <div class="dashboard-metric-icon dashboard-metric-icon-income">
            <svg class="dashboard-metric-icon-svg dashboard-metric-icon-svg-income" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 11l5-5m0 0l5 5m-5-5v12"></path>
            </svg>
          </div>
        </div>
      </div>

      <!-- EXPENSES METRIC CARD -->
      <div class="dashboard-metric-card">
        <div class="dashboard-metric-content">
          <div>
            <p class="dashboard-metric-label"><%= t('monthly_expenses') %></p>
            <p class="dashboard-metric-value dashboard-metric-value-expenses">
              <%= format_currency(@monthly_summary[:expenses]) %>
            </p>
          </div>
          <div class="dashboard-metric-icon dashboard-metric-icon-expenses">
            <svg class="dashboard-metric-icon-svg dashboard-metric-icon-svg-expenses" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 13l-5 5m0 0l-5-5m5 5V6"></path>
            </svg>
          </div>
        </div>
      </div>

      <!-- NET FLOW METRIC CARD -->
      <div class="dashboard-metric-card">
        <div class="dashboard-metric-content">
          <div>
            <p class="dashboard-metric-label"><%= t('net_flow') %></p>
            <p class="dashboard-metric-value <%= @monthly_summary[:net] >= 0 ? 'dashboard-metric-value-net' : 'dashboard-metric-value-net-negative' %>">
              <%= format_currency(@monthly_summary[:net]) %>
            </p>
          </div>
          <div class="dashboard-metric-icon <%= @monthly_summary[:net] >= 0 ? 'dashboard-metric-icon-net' : 'dashboard-metric-icon-net-negative' %>">
            <svg class="dashboard-metric-icon-svg <%= @monthly_summary[:net] >= 0 ? 'dashboard-metric-icon-svg-net' : 'dashboard-metric-icon-svg-net-negative' %>" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 7h8m0 0v8m0-8l-8 8-4-4-6 6"></path>
            </svg>
          </div>
        </div>
      </div>
    </section>

    <!-- CHARTS ROW: Bank Accounts and Spending Trends -->
    <div class="dashboard-charts-grid">
      
      <!-- BANK ACCOUNTS OVERVIEW: Account List -->
      <div class="dashboard-card">
        <div class="dashboard-card-header">
          <h3 class="dashboard-card-title"><%= t('bank_accounts_overview') %></h3>
          <a href="/bank_accounts" class="dashboard-card-link"><%= t('view_all') %></a>
        </div>
        
        <% if @bank_summaries.any? %>
          <div class="dashboard-accounts-list">
            <% @bank_summaries.each do |summary| %>
              <div class="dashboard-account-item">
                <div class="dashboard-account-left">
                  <div class="dashboard-account-icon">
                    <svg class="dashboard-account-icon-svg" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 10h18M7 15h1m4 0h1m-7 4h12a3 3 0 003-3V8a3 3 0 00-3-3H6a3 3 0 00-3 3v8a3 3 0 003 3z"></path>
                    </svg>
                  </div>
                  <div>
                    <p class="dashboard-account-name"><%= summary[:account].bank_name %></p>
                    <p class="dashboard-account-number"><%= summary[:account].account_number %></p>
                  </div>
                </div>
                <div class="dashboard-account-right">
                  <p class="dashboard-account-balance">
                    <%= format_currency(summary[:balance]) %>
                  </p>
                  <p class="dashboard-account-transactions"><%= summary[:transaction_count] %> <%= t('transactions') %></p>
                </div>
              </div>
            <% end %>
          </div>
        <% else %>
          <div class="dashboard-empty-state">
            <svg class="dashboard-empty-icon" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 10h18M7 15h1m4 0h1m-7 4h12a3 3 0 003-3V8a3 3 0 00-3-3H6a3 3 0 00-3 3v8a3 3 0 003 3z"></path>
            </svg>
            <p class="dashboard-empty-title"><%= t('no_bank_accounts_yet') %></p>
            <p class="dashboard-empty-description"><%= t('add_first_bank_account') %></p>
            <a href="/bank_accounts/new" class="dashboard-empty-action">
              <%= t('add_bank_account') %>
            </a>
          </div>
        <% end %>
      </div>

      <!-- SPENDING TRENDS CHART: Monthly Spending Visualization -->
      <div class="dashboard-card">
        <div class="dashboard-card-header">
          <h3 class="dashboard-card-title"><%= t('spending_trends') %></h3>
          <span class="dashboard-card-subtitle"><%= t('last_6_months') %></span>
        </div>
        
        <% if @spending_trends.any? %>
          <div class="dashboard-chart-container">
            <canvas data-dashboard-charts-target="spendingChart"></canvas>
          </div>
          
          <div class="dashboard-chart-total">
            <p class="dashboard-chart-total-text">
              <%= t('total') %>: <%= format_currency(@spending_trends.sum { |t| t[:amount] }) %>
            </p>
          </div>
        <% else %>
          <div class="dashboard-chart-container flex items-center justify-center text-slate-500">
            <div class="dashboard-empty-state">
              <svg class="dashboard-empty-icon" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2zm0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z"></path>
              </svg>
              <p class="dashboard-empty-title"><%= t('no_spending_data_yet') %></p>
              <p class="dashboard-empty-description"><%= t('upload_statements_to_see_spending_trends') %></p>
            </div>
          </div>
        <% end %>
      </div>
    </div>

    <!-- CHARTS ROW: Category Breakdown and Account Balances -->
    <div class="dashboard-charts-grid">
      
      <!-- CATEGORY BREAKDOWN CHART: Spending by Category -->
      <div class="dashboard-card">
        <div class="dashboard-card-header">
          <h3 class="dashboard-card-title"><%= t('spending_by_category') %></h3>
          <a href="/categories" class="dashboard-card-link"><%= t('manage_categories') %></a>
        </div>
        
        <% if @category_summary.any? %>
          <div class="dashboard-chart-container">
            <canvas data-dashboard-charts-target="categoryChart"></canvas>
          </div>
        <% else %>
          <div class="dashboard-chart-container flex items-center justify-center text-slate-500">
            <div class="dashboard-empty-state">
              <svg class="dashboard-empty-icon" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2zm0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z"></path>
              </svg>
              <p class="dashboard-empty-title"><%= t('no_categories_yet') %></p>
              <p class="dashboard-empty-description"><%= t('add_categories_to_see_spending_breakdown') %></p>
            </div>
          </div>
        <% end %>
      </div>

      <!-- ACCOUNT BALANCES CHART: Account Balance Visualization -->
      <div class="dashboard-card">
        <div class="dashboard-card-header">
          <h3 class="dashboard-card-title"><%= t('account_balances') %></h3>
          <span class="dashboard-card-subtitle"><%= t('current_balances') %></span>
        </div>
        
        <% if @bank_summaries.any? %>
          <div class="dashboard-chart-container">
            <canvas data-dashboard-charts-target="balanceChart"></canvas>
          </div>
        <% else %>
          <div class="dashboard-chart-container flex items-center justify-center text-slate-500">
            <div class="dashboard-empty-state">
              <svg class="dashboard-empty-icon" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2zm0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z"></path>
              </svg>
              <p class="dashboard-empty-title"><%= t('no_accounts_yet') %></p>
              <p class="dashboard-empty-description"><%= t('add_bank_accounts_to_see_balance_chart') %></p>
            </div>
          </div>
        <% end %>
      </div>
    </div>

    <!-- RECENT TRANSACTIONS: Latest Transaction History -->
    <section class="dashboard-card mb-8">
      <div class="dashboard-card-header">
        <h3 class="dashboard-card-title"><%= t('recent_transactions') %></h3>
        <a href="/transactions" class="dashboard-card-link"><%= t('view_all') %></a>
      </div>
      
      <% if @recent_transactions.any? %>
        <div class="dashboard-transactions-table">
          <table class="dashboard-transactions-table-main">
            <thead class="dashboard-transactions-header">
              <tr>
                <th class="dashboard-transactions-header-row"><%= t('date') %></th>
                <th class="dashboard-transactions-header-row"><%= t('description') %></th>
                <th class="dashboard-transactions-header-row"><%= t('category') %></th>
                <th class="dashboard-transactions-header-row"><%= t('account') %></th>
                <th class="dashboard-transactions-header-row text-right"><%= t('amount') %></th>
              </tr>
            </thead>
            <tbody class="dashboard-transactions-body">
              <% @recent_transactions.each do |transaction| %>
                <tr class="dashboard-transactions-row">
                  <td class="dashboard-transactions-cell">
                    <span class="dashboard-transactions-cell-text">
                      <%= transaction.date.strftime("%b %d, %Y") %>
                    </span>
                  </td>
                  <td class="dashboard-transactions-cell">
                    <span class="dashboard-transactions-cell-text dashboard-transactions-cell-text-truncate">
                      <%= transaction.description %>
                    </span>
                  </td>
                  <td class="dashboard-transactions-cell">
                    <% if transaction.category %>
                      <span class="dashboard-transactions-category">
                        <%= transaction.category.name %>
                      </span>
                    <% else %>
                      <span class="dashboard-transactions-category-empty">-</span>
                    <% end %>
                  </td>
                  <td class="dashboard-transactions-cell">
                    <span class="dashboard-transactions-cell-account">
                      <%= transaction.bank_account.bank_name %>
                    </span>
                  </td>
                  <td class="dashboard-transactions-cell dashboard-transactions-cell-amount">
                    <span class="<%= transaction.btype_credit? ? 'dashboard-transactions-cell-amount-credit' : 'dashboard-transactions-cell-amount-debit' %>">
                      <%= transaction.btype_credit? ? '+' : '-' %><%= format_currency(transaction.amount) %>
                    </span>
                  </td>
                </tr>
              <% end %>
            </tbody>
          </table>
        </div>
      <% else %>
        <div class="dashboard-empty-state">
          <svg class="dashboard-empty-icon" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2zm0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z"></path>
          </svg>
          <p class="dashboard-empty-title"><%= t('no_transactions_yet') %></p>
          <p class="dashboard-empty-description"><%= t('upload_statements_to_see_transaction_history') %></p>
        </div>
      <% end %>
    </section>

    <!-- QUICK ACTIONS: Common User Actions -->
    <section class="dashboard-quick-actions">
      <h3 class="dashboard-quick-actions-title"><%= t('quick_actions') %></h3>
      <div class="dashboard-quick-actions-grid">
        
        <!-- UPLOAD STATEMENT ACTION -->
        <a href="/statement_files/new" class="dashboard-quick-action-card dashboard-quick-action-card-upload">
          <div class="dashboard-quick-action-content">
            <div class="dashboard-quick-action-icon dashboard-quick-action-icon-upload">
              <svg class="dashboard-quick-action-icon-svg dashboard-quick-action-icon-svg-upload" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4"></path>
              </svg>
            </div>
            <div>
              <p class="dashboard-quick-action-title"><%= t('upload_statement') %></p>
              <p class="dashboard-quick-action-description"><%= t('add_new_bank_data') %></p>
            </div>
          </div>
        </a>

        <!-- VIEW TRANSACTIONS ACTION -->
        <a href="/transactions" class="dashboard-quick-action-card dashboard-quick-action-card-transactions">
          <div class="dashboard-quick-action-content">
            <div class="dashboard-quick-action-icon dashboard-quick-action-icon-transactions">
              <svg class="dashboard-quick-action-icon-svg dashboard-quick-action-icon-svg-transactions" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2zm0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z"></path>
              </svg>
            </div>
            <div>
              <p class="dashboard-quick-action-title"><%= t('transactions') %></p>
              <p class="dashboard-quick-action-description"><%= t('see_all_activity') %></p>
            </div>
          </div>
        </a>

        <!-- MANAGE ACCOUNTS ACTION -->
        <a href="/bank_accounts" class="dashboard-quick-action-card dashboard-quick-action-card-accounts">
          <div class="dashboard-quick-action-content">
            <div class="dashboard-quick-action-icon dashboard-quick-action-icon-accounts">
              <svg class="dashboard-quick-action-icon-svg dashboard-quick-action-icon-svg-accounts" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 10h18M7 15h1m4 0h1m-7 4h12a3 3 0 003-3V8a3 3 0 00-3-3H6a3 3 0 00-3 3v8a3 3 0 003 3z"></path>
              </svg>
            </div>
            <div>
              <p class="dashboard-quick-action-title"><%= t('bank_accounts') %></p>
              <p class="dashboard-quick-action-description"><%= t('update_bank_info') %></p>
            </div>
          </div>
        </a>

        <!-- MANAGE CATEGORIES ACTION -->
        <a href="/categories" class="dashboard-quick-action-card dashboard-quick-action-card-categories">
          <div class="dashboard-quick-action-content">
            <div class="dashboard-quick-action-icon dashboard-quick-action-icon-categories">
              <svg class="dashboard-quick-action-icon-svg dashboard-quick-action-icon-svg-categories" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 11H5m14 0a2 2 0 012 2v6a2 2 0 01-2 2H5a2 2 0 01-2-2v-6a2 2 0 012-2m14 0V9a2 2 0 00-2-2M5 11V9a2 2 0 012-2m0 0V5a2 2 0 012-2h6a2 2 0 012 2v2M7 7h10"></path>
              </svg>
            </div>
            <div>
              <p class="dashboard-quick-action-title"><%= t('categories') %></p>
              <p class="dashboard-quick-action-description"><%= t('organize_spending') %></p>
            </div>
          </div>
        </a>
      </div>
    </section>
  </div>
</main>
