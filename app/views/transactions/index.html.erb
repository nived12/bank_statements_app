<h1>Transactions</h1>

<%= form_with url: "/transactions", method: :get, local: true do %>
  <label for="bank_account_id">Bank account:</label>
  <select name="bank_account_id" id="bank_account_id">
    <option value="">All</option>
    <% @bank_accounts.each do |ba| %>
      <option value="<%= ba.id %>" <%= "selected" if params[:bank_account_id].to_s == ba.id.to_s %>>
        <%= ba.display_name %>
      </option>
    <% end %>
  </select>
  <button type="submit">Filter</button>
<% end %>

<table border="1" cellpadding="6" style="margin-top:12px;">
  <thead>
    <tr>
      <th>Date</th><th>Description</th><th>Merchant</th><th>Reference</th><th>Amount</th><th>Type</th><th>Bank Entry</th><th>Category</th><th></th>
    </tr>
  </thead>
  <tbody>
    <% @transactions.each do |t| %>
      <tr>
        <td><%= t.date %></td>
        <td><%= t.description %></td>
        <td>
          <%= form_with url: "/transactions/#{t.id}", method: :patch, local: true do |f| %>
            <input type="text" name="transaction[merchant]" value="<%= t.merchant %>" style="width: 100px;">
            <button type="submit" style="font-size: 10px;">Save</button>
          <% end %>
        </td>
        <td>
          <%= form_with url: "/transactions/#{t.id}", method: :patch, local: true do |f| %>
            <input type="text" name="transaction[reference]" value="<%= t.reference %>" style="width: 100px;">
            <button type="submit" style="font-size: 10px;">Save</button>
          <% end %>
        </td>
        <td><%= t.amount %></td>
        <td>
          <%= form_with url: "/transactions/#{t.id}", method: :patch, local: true do |f| %>
            <select name="transaction[transaction_type]">
              <% Transaction.transaction_types.keys.each do |opt| %>
                <option value="<%= opt %>" <%= "selected" if t.transaction_type == opt %>><%= opt %></option>
              <% end %>
            </select>
        </td>
        <td><%= t.bank_entry_type %></td>
        <td>
          <%= form_with url: "/transactions/#{t.id}", method: :patch, local: true do |f| %>
            <select name="transaction[category_id]">
              <option value="">No Category</option>
              <% current_user.categories.order(:name).each do |cat| %>
                <option value="<%= cat.id %>" <%= "selected" if t.category_id == cat.id %>>
                  <%= cat.name %>
                </option>
              <% end %>
            </select>
            <button type="submit" style="font-size: 10px;">Save</button>
          <% end %>
        </td>
      </tr>
    <% end %>
  </tbody>
</table>
